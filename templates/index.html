<!DOCTYPE html>
<html>
<head>
    <title>Hurricane Tracker</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        /* Style the map container */
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>

<h1>Hurricane Tracker</h1>
<div id="map"></div>
<div id="weather"></div> <!-- This div will show the weather data -->

<script>
    // OpenWeatherMap API key from Flask
    const openWeatherAPIKey = '{{ openweather_api_key }}';

    // Sample hurricane data (You can replace this with actual hurricane data)
    const hurricaneData = [
        { lat: 29.7604, lng: -95.3698, intensity: 0.8 },  // Example: Houston
        { lat: 25.7617, lng: -80.1918, intensity: 0.6 },  // Example: Miami
        { lat: 34.0522, lng: -118.2437, intensity: 0.5 }  // Example: Los Angeles
    ];

    // Initialize and add the map
    function initMap() {
        // The location you want to center the map on (Example: San Francisco)
        var location = { lat: 37.7749, lng: -122.4194 };

        // The map, centered at the chosen location
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 5,
            center: location
        });

        // Add a click event listener to the map
        map.addListener('click', function(event) {
            var lat = event.latLng.lat();  // Get latitude
            var lng = event.latLng.lng();  // Get longitude
            console.log("Coordinates: Latitude: " + lat + ", Longitude: " + lng);
            
            // Fetch weather data for the clicked coordinates
            fetchWeather(lat, lng);
        });

        // Add hurricane markers
        addHurricaneMarkers(map);

        // Add hurricane heatmap
        addHurricaneHeatmap(map);
    }

    // Function to add hurricane markers
    function addHurricaneMarkers(map) {
        hurricaneData.forEach((hurricane) => {
            new google.maps.Marker({
                position: { lat: hurricane.lat, lng: hurricane.lng },
                map: map,
                title: `Hurricane (Intensity: ${hurricane.intensity})`
            });
        });
    }

    // Function to add a hurricane heatmap
    function addHurricaneHeatmap(map) {
        // Convert hurricane data into Google Maps LatLng objects for the heatmap
        const heatmapData = hurricaneData.map(hurricane => {
            return {
                location: new google.maps.LatLng(hurricane.lat, hurricane.lng),
                weight: hurricane.intensity
            };
        });

        const heatmap = new google.maps.visualization.HeatmapLayer({
            data: heatmapData,
            dissipating: true,
            radius: 50 // Adjust radius for better visualization
        });

        heatmap.setMap(map);
    }

    // Function to fetch weather data from OpenWeatherMap API
    function fetchWeather(lat, lng) {
        // OpenWeatherMap API URL with the latitude, longitude, and API key
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${openWeatherAPIKey}&units=metric`;

        // Fetch the weather data
        fetch(url)
            .then(response => response.json())
            .then(data => {
                console.log(data); // Log the weather data
                displayWeather(data); // Call function to display weather
            })
            .catch(error => console.error('Error fetching weather data:', error));
    }

    // Function to display weather data on the page
    function displayWeather(data) {
        const weatherDiv = document.getElementById('weather');
        weatherDiv.innerHTML = `
            <h2>Weather Information</h2>
            <p>Location: ${data.name}</p>
            <p>Temperature: ${data.main.temp}Â°C</p>
            <p>Weather: ${data.weather[0].description}</p>
        `;
    }
</script>

<!-- Load the Google Maps API with visualization library for heatmaps -->
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap&libraries=visualization">
</script>

</body>
</html>
